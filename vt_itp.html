<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HGPT - Tem tr√¨nh m·∫´u D·ª± √°n (70√ó35mm)</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    :root{
      --page-w: 70mm;
      --page-h: 35mm;
      --pad: 2mm;
      --gap: 2mm;
      --font: "Times New Roman", Times, serif;
    }
    *{ box-sizing: border-box; }
    body{ margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:#f3f5f8; color:#0f172a; }
    .wrap{ max-width:960px; margin:24px auto; padding:16px; background:#fff; border-radius:14px; box-shadow:0 8px 24px rgba(2,6,23,.08); }
    h1{ font-size:28px; margin:0 0 12px; padding: 12px 0 0 0; color:rgb(129, 95, 8) }
    .row{ display:flex; gap:12px; align-items:center; margin-bottom:8px; flex-wrap:wrap; }
    button, a.link{
      padding:10px 18px; border-radius:10px; border:2px solid #ffad56; background:#fff; color:#ff7a00;
      font-weight:700; cursor:pointer; text-decoration:none;
    }
    button:hover, a.link:hover{ background:#ffad56; color:#fff; }
    .status{ font-size:16px; color:#475569; margin-left:8px; }
    .note{ font-size:14px; color:#64748b; margin-top:4px; }

    .print-container{ display:none; }
    /* === PRINT: 3 tem ngang (105√ó70mm) === */
  @media print{
  *{-webkit-print-color-adjust:exact !important; color-adjust:exact !important;}

  /* ·∫®n UI, ch·ªâ ƒë·ªÉ v√πng in */
  .container{ display:none !important; }
  #dataContainer{ display:none !important; visibility:hidden !important; height:0 !important; overflow:hidden !important; }

  /* Kh·ªï gi·∫•y ƒë√∫ng 105√ó70mm, kh√¥ng margin */
  @page{ size: 105mm 70mm; margin:0; }

  body{ margin:0 !important; padding:0 !important; background:#fff !important; }
  body *{ visibility:hidden; }
  .print-container, .print-container *{ visibility:visible; }

  .print-container{
    position:fixed; top:0; left:0; right:0;
    width:100% !important; height:100% !important;
    display:block !important; margin:0 !important; padding:0 !important;
  }

  /* Trang in 105x70mm - 3 tem ngang */
  .label-page-horizontal{
    width:105mm; height:70mm;
    margin:0; padding:0; box-sizing:border-box;
    display:flex; flex-direction:row; background:#fff; font-family:Arial, sans-serif;

    /* ph√¢n trang: ch·ªâ ng·∫Øt tr∆∞·ªõc trang k·∫ø ti·∫øp, kh√¥ng t·∫°o trang tr·∫Øng cu·ªëi */
    page-break-inside:avoid;
    break-inside:avoid;
    page-break-after:always;
  }
  .label-page-horizontal:last-child{
    page-break-after:auto;
  }

  /* M·ªói tem 35x70mm (3 tem = 105mm) */
  .label-item-horizontal{
    width:35mm; height:70mm; position:relative; overflow:hidden;
    border-right:1px dashed #ccc;
  }
  .label-item-horizontal:last-child{ border-right:none; }

  /* B·ªë c·ª•c trong tem: xoay tr√°i 90¬∞ ƒë·ªÉ n·ªôi dung n·∫±m ngang theo chi·ªÅu tem */
  .label-item-horizontal .label-wrapper{
    position:absolute;
    transform:rotate(90deg);
    transform-origin:center center;

    /* sau xoay, k√≠ch th∆∞·ªõc n·ªôi dung l√† 70√ó35mm */
    width:70mm; height:35mm;

    /* cƒÉn gi·ªØa wrapper v√†o khung tem 35√ó70mm */
    left:-17.5mm;  /* = -(70-35)/2  */
    top:17.5mm;    /* =  (70-35)/2  */

    display:flex; flex-direction:column;
    padding:8mm 2mm 2mm 2mm; box-sizing:border-box;
  }

  /* Header (t√™n KH) */
  .label-item-horizontal .label-header{
    width:80%; font-size:12px; font-weight:bold; line-height:1.2;
    color:#000; margin-bottom:2mm; word-wrap:break-word; overflow-wrap:break-word;
  }

  /* N·ªôi dung */
  .label-item-horizontal .label-content{ display:flex; flex-direction:row; gap:1mm; align-items:stretch; flex:1; }

  .label-item-horizontal .label-info{ flex:1; display:flex; flex-direction:column; gap:1mm; }
  .label-item-horizontal .label-info .ten_sp{ font-size:10px; color:#000; line-height:1.1; }
  .label-item-horizontal .label-info .component-name{ font-size:12px; font-weight:bold; color:#000; line-height:1.3; margin-top:0; }
  .label-item-horizontal .label-info .additional-info{ font-size:11px; color:#000; font-weight:bold; line-height:1.2; margin-top:1mm; }

  .label-item-horizontal .qr-container{ width:17mm; margin-right:2mm; display:flex; flex-direction:column; gap:1mm; }
  .label-item-horizontal .qr-container img{
    width:10mm !important; height:10mm !important; max-width:10mm !important; max-height:10mm !important;
  }
  .label-item-horizontal .qr-code-id{ font-size:12px; color:#000; line-height:1; text-align:center; }
}
  </style>
</head>
<body>
  <div class="wrap">
    <img src="https://hgptsteel.com/wp-content/uploads/2025/06/cropped-HGPT-STEEL-1-1.png" alt="HGPT Logo" style="height:38px; vertical-align:middle;">
    <h1>Tem m·∫´u v·∫≠t t∆∞ D·ª± √°n</h1>
    <div class="row">
      <button id="btnPrint">üñ®Ô∏è IN TEM</button>
      <a href="https://docs.google.com/spreadsheets/d/1NfxVAG9r1i6-Kb5GoxPSQ9yN2RmEi6SLeNlVRFzHAE0/edit?usp=sharing" class="link" target="_blank">üîó M·ªü link Sheet n·ªÅn</a>
      <span class="status" id="status">
    <i class="fa-solid fa-check fa-xl" style="color: #004ffa;"></i>
    S·∫µn s√†ng in r·ªìi :)  !
</span>
    </div>
    <div class="note">
      Ngu·ªìn d·ªØ li·ªáu: Google Sheet t·∫°i <b>"Sheet1"</b> g·ªìm c√°c c·ªôt:<br>------<br><b>1. STT</b>,<br><b>2. CHUNGLOAI-QUYCACH</b>,<br> <b>3. VATLIEU</b>,<br> <b>4. VITRI</b>,<br> <b>5. SOLUONG</b>.<br>
      -------<br>
      <b>**In theo th·ª© t·ª± ·ªü c·ªôt STT**</b>
    </div>
  </div>

  <div class="print-container" id="printContainer"></div>

  <script>
  // ====== C·∫§U H√åNH ======
  const GOOGLE_SHEET_ID = '1NfxVAG9r1i6-Kb5GoxPSQ9yN2RmEi6SLeNlVRFzHAE0';
  const SHEET_NAME = 'Sheet1';

  document.addEventListener('DOMContentLoaded', () => {
    const $ = (s)=>document.querySelector(s);
    const statusEl = $('#status');
    const printContainer = $('#printContainer');
    const sheetLink = $('#sheetLink');
    const btnPrint = $('#btnPrint');

    // G√°n link sheet (c√≥ guard ƒë·ªÉ kh√¥ng n√©m l·ªói)
    if (sheetLink) {
      sheetLink.href = `https://docs.google.com/spreadsheets/d/${GOOGLE_SHEET_ID}/edit#gid=0`;
    }

    async function fetchSheetGViz(sheetId, sheetName){
      const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(sheetName)}`;
      const resp = await fetch(url);
      const text = await resp.text();
      const json = JSON.parse(text.substring(text.indexOf('{'), text.lastIndexOf('}') + 1));
      const headers = (json.table.cols || []).map((c, i) => (c && c.label) ? c.label : `Col${i+1}`);
      const rows = [];
      for (const r of json.table.rows){
        if (!r || !r.c) continue;
        const o = {};
        headers.forEach((h, i) => { o[h] = r.c[i] ? (r.c[i].v ?? '') : ''; });
        rows.push(o);
      }
      return rows;
    }

    const norm = s => String(s||'').toLowerCase().replace(/\s+/g,'');
    function pick(obj, names){
      const keys = Object.keys(obj);
      for (const want of names){
        const hitKey = keys.find(k => norm(k) === norm(want));
        if (hitKey !== undefined) return obj[hitKey];
      }
      return '';
    }

    async function printFromSheet(){
      statusEl.textContent = 'ƒêang t·∫£i d·ªØ li·ªáu Sheet...';
      printContainer.innerHTML = '';

      let rows;
      try{
        rows = await fetchSheetGViz(GOOGLE_SHEET_ID, SHEET_NAME);
      }catch(e){
        statusEl.textContent = 'L·ªói t·∫£i Sheet';
        alert('Kh√¥ng ƒë·ªçc ƒë∆∞·ª£c d·ªØ li·ªáu Google Sheet:\n' + e.message);
        return;
      }

      if (!rows.length){
        statusEl.textContent = 'Kh√¥ng c√≥ d·ªØ li·ªáu.';
        alert('Sheet tr·ªëng ho·∫∑c kh√¥ng c√≥ h√†ng d·ªØ li·ªáu.');
        return;
      }

      // sort theo STT
      rows.sort((a,b)=>{
        const A = Number(pick(a, ['STT','stt'])) || 0;
        const B = Number(pick(b, ['STT','stt'])) || 0;
        return A - B;
      });

      statusEl.textContent = 'ƒêang t·∫°o tem...';
      const frag = document.createDocumentFragment();
      let total = 0;

      for (const r of rows){
        const STT = pick(r, ['STT','stt']);
        const CHUNGLOAI = String(pick(r, ['CHUNGLOAI','Ch·ªßng lo·∫°i','chungloai'])||'').trim();
        const VATLIEU   = String(pick(r, ['VATLIEU','V·∫≠t li·ªáu','vatlieu'])||'').trim();
        const VITRI     = String(pick(r, ['VITRI','V·ªã tr√≠','vitri'])||'').trim();
        const SLraw     = pick(r, ['SOLUONG','Soluong','SL','soluong']);
        const SL        = Number.parseInt(SLraw,10);

      // üëâ B·ªè qua h√†ng n·∫øu Soluong tr·ªëng, kh√¥ng ph·∫£i s·ªë, ho·∫∑c = 0
      if (!SLraw || isNaN(SL) || SL <= 0) continue;

      // üëâ C≈©ng b·ªè qua n·∫øu CHUNGLOAI r·ªóng (tu·ª≥ b·∫°n gi·ªØ hay b·ªè)
      if (!CHUNGLOAI) continue;

        for (let i=0; i<SL; i++){
          total++;
          const page = document.createElement('div');
          page.className = 'label';
          page.innerHTML = `
            <div class="text">
              <div class="stt">STT: ${STT || ''}</div>
              <div class="ten">${CHUNGLOAI.toUpperCase()}</div>
              <div class="meta">
                <b>VL:</b> ${VATLIEU || ''} &nbsp;|&nbsp;
                <b>VT:</b> ${VITRI || ''}
              </div>
            </div>`;
          frag.appendChild(page);
        }
      }

      if (!total){
        statusEl.textContent = 'Kh√¥ng c√≥ b·∫£n ghi h·ª£p l·ªá.';
        alert('Thi·∫øu CHUNGLOAI ho·∫∑c SOLUONG = 0 ·ªü m·ªçi h√†ng.');
        return;
      }

      printContainer.appendChild(frag);
      statusEl.textContent = `ƒê√£ t·∫°o ${total} tem ‚Ä¢ m·ªü h·ªôp tho·∫°i in...`;
      setTimeout(()=>{ window.print(); statusEl.textContent = 'S·∫µn s√†ng'; }, 120);
    }

    // G·∫Øn s·ª± ki·ªán sau khi DOM s·∫µn s√†ng
    if (btnPrint) btnPrint.addEventListener('click', printFromSheet);
  });
</script>
</body>
</html>
